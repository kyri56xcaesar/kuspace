FROM golang:1.23.4 AS builder 
WORKDIR /app
COPY go.mod go.sum ./ 
RUN go mod download 
COPY ./internal/userspace/ ./internal/userspace/
COPY ./internal/utils/ ./internal/utils/
COPY ./cmd/userspace/ ./cmd/userspace/ 
COPY ./api/userspace/ ./api/userspace/
COPY ./pkg/fslite/ ./pkg/fslite/

RUN GOOS=linux go build -o ./cmd/userspace/userspace ./cmd/userspace/main.go 

FROM debian:bookworm-slim
WORKDIR /root/
RUN apt-get update && apt-get install -y libstdc++6 
COPY --from=builder /app/cmd/userspace/userspace .
COPY ./configs/userspace.conf ./configs/ 

RUN chmod +x /root/userspace
CMD ["./userspace"]

